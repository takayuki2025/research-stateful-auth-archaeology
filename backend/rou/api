<?php

use Illuminate\Support\Facades\Route;

/*
|--------------------------------------------------------------------------
| Health Check
|--------------------------------------------------------------------------
*/
Route::get('/health', fn () => ['status' => 'ok']);

/*
|--------------------------------------------------------------------------
| ðŸ” Auth : Firebase â†’ JWTï¼ˆå®Ÿè£…æ¸ˆãƒ»æ¤œè¨¼å¯¾è±¡ï¼‰
|--------------------------------------------------------------------------
*/
use App\Modules\Auth\Presentation\Http\Controllers\{
    FirebaseAuthController,
    TokenController,
    MeController,
    DeviceSessionsController
};

// Login / Register
Route::post('/login_or_register', [FirebaseAuthController::class, 'loginOrRegister']);

// Refresh Token
Route::post('/auth/refresh', [TokenController::class, 'refresh']);

// ãƒ¡ãƒ¼ãƒ«èªè¨¼ã®éš›ã®ãƒ¡ãƒ¼ãƒ«å†é€ä¿¡
use App\Modules\Auth\Presentation\Http\Controllers\ResendEmailVerificationController;

Route::middleware(['auth.jwt.optional'])
    ->post(
        '/email/verification-notification',
        ResendEmailVerificationController::class
    );



use App\Modules\Shop\Presentation\Http\Controllers\ShopController;

Route::middleware(['auth.jwt'])->group(function () {
    Route::post('/shops', [ShopController::class, 'create']);
    Route::get('/shops/me', [ShopController::class, 'me']);
});



// === Shop / Tenant ===
use App\Modules\Item\Presentation\Http\Controllers\{
    ShopShowController,
    ShopItemListController
};

Route::prefix('shops/{shop_code}')
    ->middleware(['shop.context',])
    ->group(function () {
        Route::get('/', ShopShowController::class);
        Route::get('/items', ShopItemListController::class);
    });

// =======================================================
// ðŸª Shop Dashboard / Managementï¼ˆâ˜…ç¢ºå®šãƒ«ãƒ¼ãƒˆï¼‰
// =======================================================
use App\Modules\Order\Presentation\Http\Controllers\ShopOrderListController;
use App\Modules\Order\Presentation\Http\Controllers\ShopOrderShipmentController;
use App\Modules\Shipment\Presentation\Http\Controllers\ShopShipmentListController;
use App\Modules\Shipment\Presentation\Http\Controllers\ShipmentController;

Route::prefix('shops/{shop_code}')
    ->middleware([
        'auth.jwt',
        'shop.context',
        // 'shop.role:owner,manager,staff',
    ])
    ->group(function () {

        // æ³¨æ–‡ä¸€è¦§
        Route::get('/dashboard/orders', ShopOrderListController::class);

        // é…é€çŠ¶æ…‹å–å¾—ï¼ˆGETï¼‰
        Route::get(
            '/dashboard/orders/{orderId}/shipment',
            ShopOrderShipmentController::class
        );
        // é…é€ä¸€è¦§
        Route::get('/shipments', ShopShipmentListController::class);


        // â˜… Aãƒ•ã‚§ãƒ¼ã‚ºï¼šé…é€ä½œæˆï¼ˆPOSTï¼‰
        Route::post(
            '/dashboard/orders/{orderId}/shipment',
            [ShipmentController::class, 'store']
        );
    });





use App\Modules\Order\Presentation\Http\Controllers\OrderController;

Route::middleware(['auth.jwt'])->group(function () {
    Route::post('/orders', [OrderController::class, 'create']);
    Route::post('/orders/{orderId}/address', [OrderController::class, 'confirmAddress']);
    Route::get('/orders/{orderId}', [OrderController::class, 'detail']);
});

use App\Modules\Order\Presentation\Http\Controllers\ConfirmOrderController;

Route::post(
    '/orders/{orderId}/confirm',
    ConfirmOrderController::class
)->middleware('auth.jwt');


// ã‚·ãƒ§ãƒƒãƒ—é–¢ä¿‚è€…ã®é…é€ç®¡ç†å‡¦ç†
use App\Modules\Shipment\Presentation\Http\Controllers\PackShipmentController;
use App\Modules\Shipment\Presentation\Http\Controllers\ShipShipmentController;
use App\Modules\Shipment\Presentation\Http\Controllers\InTransitShipmentController;
use App\Modules\Shipment\Presentation\Http\Controllers\DeliverShipmentController;

Route::prefix('shipments/{shipmentId}')
    ->middleware(['auth.jwt'])
    ->group(function () {
        Route::post('pack', PackShipmentController::class);
        Route::post('ship', ShipShipmentController::class);
        Route::post('in-transit', InTransitShipmentController::class);
        Route::post('deliver', DeliverShipmentController::class);
    });

/*
|--------------------------------------------------------------------------
| ðŸ” JWT Protectedï¼ˆæœ€ä½Žé™ï¼‰
|--------------------------------------------------------------------------
*/
Route::middleware(['auth.jwt'])->group(function () {
    Route::get('/me', MeController::class);
    Route::post('/logout', [FirebaseAuthController::class, 'logout']);

    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèªï¼ˆå®Ÿè£…æ¸ˆï¼‰
    Route::get('/auth/sessions', [DeviceSessionsController::class, 'list']);
});

/*
|--------------------------------------------------------------------------
| ðŸŒ Public Item APIï¼ˆä»Šå›žã®æ¤œè¨¼ãƒ¡ã‚¤ãƒ³ï¼‰
|--------------------------------------------------------------------------
*/
use App\Modules\Item\Presentation\Http\Controllers\{
    ItemListController,
    //  ItemSearchController,
    ItemDetailController
};
use App\Modules\Item\Presentation\Http\Controllers\PublicCatalogController;
use App\Modules\Search\Presentation\Http\Controllers\PublicItemSearchController;
use App\Modules\Search\Presentation\Http\Controllers\ShopItemSearchController;

// âœ… æ–°ï¼šä¸€è¦§ / æ¤œç´¢ï¼ˆDDD åˆ†é›¢æ¸ˆï¼‰




Route::middleware(['auth.jwt.optional'])->group(function () {

    Route::get('/items/public', PublicCatalogController::class);

    Route::get('/search/items', PublicItemSearchController::class);

    // â˜… Shop å°‚ç”¨æ¤œç´¢
    Route::get('/search/shop-items', ShopItemSearchController::class);
});







// Route::middleware('auth.jwt.optional')->group(function () {
//     Route::get('/items/public', PublicItemListController::class);
// });

Route::middleware('auth.jwt.optional')
    ->get('/item/{id}', ItemDetailController::class);









// Route::get('/public/items', PublicItemListController::class);

// Route::middleware('auth.jwt')->group(function () {
//     Route::get('/items', ItemListController::class); // Domain
// });







use App\Modules\Item\Presentation\Http\Controllers\CreateItemDraftController;
use App\Modules\Item\Presentation\Http\Controllers\UploadItemDraftImageController;
use App\Modules\Item\Presentation\Http\Controllers\PublishItemController;
use App\Modules\Item\Presentation\Http\Controllers\DeleteItemDraftController;

Route::middleware(['auth.jwt'])->group(function () {
    Route::post('/items/drafts', CreateItemDraftController::class);
    Route::post('/items/drafts/{draftId}/image', UploadItemDraftImageController::class);
    Route::post('/items/drafts/{draftId}/publish', PublishItemController::class);
});
Route::middleware(['auth.jwt'])->group(function () {
    Route::delete(
        '/items/drafts/{draftId}',
        DeleteItemDraftController::class
    );
});




use App\Http\Controllers\ItemEntityReviewController;
use App\Http\Controllers\ItemEntityAuditController;
use App\Http\Controllers\EntityKpiController;

//ãƒ‡ãƒ¼ã‚¿ãƒ¼åŠ å·¥ä¿ç®¡å‡¦ç†
Route::get('/entity-reviews', [ItemEntityReviewController::class, 'index']);
Route::post('/entity-reviews/{id}/approve', [ItemEntityReviewController::class, 'approve']);
Route::post('/entity-reviews/{id}/reject', [ItemEntityReviewController::class, 'reject']);

Route::get(
    '/item-entities/{id}/audits',
    [ItemEntityAuditController::class, 'index']
);

Route::get('/entity-kpis', EntityKpiController::class);



/*
|--------------------------------------------------------------------------
| ðŸ§Š ä»¥ä¸‹ã¯æœªæ¤œè¨¼ãƒ»æœªä½¿ç”¨ï¼ˆå‰Šé™¤ã›ãšã‚³ãƒ¡ãƒ³ãƒˆåŒ–ï¼‰
|--------------------------------------------------------------------------
*/

// use App\Modules\Item\Presentation\Http\Controllers\ItemDetailController;

// use App\Modules\Item\Presentation\Http\Controllers\ItemReadController;
// === Favorite / Comment ===

use App\Modules\Reaction\Presentation\Http\Controllers\FavoriteController;
use App\Modules\Comment\Presentation\Http\Controllers\PostCommentController;

// item detailï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã§ã‚‚ã‚²ã‚¹ãƒˆã§ã‚‚è¦‹ã‚Œã‚‹ï¼‰

Route::get('/items/{itemId}', ItemDetailController::class)
    ->whereNumber('itemId')
    ->middleware('auth.jwt.optional');


// mylistï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¿…é ˆã«ã—ã¦äº‹æ•…ã‚’é¿ã‘ã‚‹ï¼‰
Route::get('/items/favorite', [FavoriteController::class, 'index'])
    ->middleware('auth.jwt');

// reactions ã¯ API å°‚ç”¨ prefix
Route::middleware('auth.jwt')->group(function () {
    Route::post('/reactions/items/{itemId}/favorite', [FavoriteController::class, 'add'])
        ->whereNumber('itemId');

    Route::delete('/reactions/items/{itemId}/favorite', [FavoriteController::class, 'remove'])
        ->whereNumber('itemId');
});


// Route::middleware('auth.jwt.optional')->group(function () {
//     Route::get('/items/favorite', [FavoriteController::class, 'index']);
// });




// Route::middleware('auth.jwt.optional')->group(function () {
//     Route::get('/items/favorite', [FavoriteController::class, 'index']);
//     // Route::get('/items/{itemId}', [ItemReadController::class, 'show']);
// });

// Route::middleware('auth.jwt')->group(function () {
//     Route::post('/items/{itemId}/favorite', [FavoriteController::class, 'add']);
//     Route::delete('/items/{itemId}/favorite', [FavoriteController::class, 'remove']);
// });
// Route::middleware('auth.jwt.optional')->group(function () {
//     Route::get('/items/{itemId}/favorite', [FavoriteController::class, 'show']);
// });


// use App\Modules\Item\Presentation\Http\Controllers\ItemReadController;

// Route::get('/items/{itemId}', [ItemReadController::class, 'show']);



// Route::prefix('items')->group(function () {
//     Route::get('{item}', [ItemReadController::class, 'show']);
// });

// Route::get('/items/{itemId}', [ItemReadController::class, 'show'])
//     ->middleware('auth.jwt.optional');



//ãƒ‡ãƒ¼ã‚¿ãƒ¼åŠ å·¥å¾Œè¡¨ç¤º
// use App\Modules\Item\Presentation\Http\Controllers\ItemReadController;

// Route::withoutMiddleware(['throttle:api'])
//     ->get('/items/{itemId}', [ItemReadController::class, 'show'])
//     ->whereNumber('itemId');






Route::middleware(['auth.jwt'])->group(function () {
    Route::post('/comment', PostCommentController::class);
});




// === MyPage / User ===

use App\Modules\User\Presentation\Http\Controllers\MypageController;
use App\Modules\Order\Presentation\Http\Controllers\MyPageBoughtController;

Route::middleware('auth.jwt')
    ->prefix('mypage')
    ->group(function () {

        // ===== Profile =====
        Route::get('/profile', [MypageController::class, 'profile']);
        Route::post('/profile', [MypageController::class, 'createProfile']); // åˆå›žã®ã¿
        Route::patch('/profile', [MypageController::class, 'updateProfile']);
        Route::post('/profile/image', [MypageController::class, 'updateProfileImage']);

        // ===== MyPage =====
        Route::get('/sell', [MypageController::class, 'sellItems']);
        Route::get('/bought', MyPageBoughtController::class);
    });








use App\Modules\Item\Infrastructure\Persistence\Query\ItemReadRepository;
use App\Modules\Item\Presentation\Http\Resources\ItemReadResource;

Route::get('/__debug/item/{id}', function ($id) {
    $item = app(ItemReadRepository::class)
        ->findWithDisplayEntities((int)$id);

    if (!$item) {
        return response()->json(['error' => 'not found'], 404);
    }

    return response()->json(
        ItemReadResource::fromRow($item)
    );
});






// Route::middleware(['auth.jwt'])->group(function () {
//     Route::post('/orders', [OrderController::class, 'create']);
//     //     Route::get('/orders/{orderId}', [OrderController::class, 'detail']);
// });





use App\Modules\Payment\Presentation\Http\Controllers\PaymentController;
use App\Modules\Payment\Presentation\Http\Controllers\StripeWebhookController;
use App\Modules\Payment\Presentation\Http\Controllers\PaymentReadController;

Route::middleware(['auth.jwt'])->group(function () {
    Route::post('/payments/start', [PaymentController::class, 'start']);
});



Route::post('/webhooks/stripe', StripeWebhookController::class);




Route::middleware('auth.jwt.optional')->group(function () {
    Route::get('/payments/latest-by-order', [PaymentReadController::class, 'latestByOrder']);
});







use App\Modules\Shipment\Presentation\Http\Controllers\AdminShipmentKpiController;
use App\Modules\Shipment\Presentation\Http\Controllers\CustomerShipmentController;

/*
|--------------------------------------------------------------------------
| Shipment (FlexVelocity_v1)
|--------------------------------------------------------------------------
*/


// // Shop Dashboardï¼ˆA ãƒ•ã‚§ãƒ¼ã‚ºã®æ­£è§£ï¼‰
// Route::prefix('shops/{shop_code}')
//     ->middleware([
//         'auth.jwt',
//         'shop.context',
//         'shop.role:owner,manager,staff'
//     ])
//     ->group(function () {

//         // Route::get('/shipments', ShopShipmentListController::class);

//         // â˜… æ‰‹å‹•ä½œæˆï¼ˆA ãƒ•ã‚§ãƒ¼ã‚ºå”¯ä¸€ã®å…¥å£ï¼‰
//         Route::post(
//             '/dashboard/orders/{orderId}/shipment',
//             [ShipmentController::class, 'store']
//         );
//     });


// Create shipment (OrderEvent::PAID ã‹ã‚‰å‘¼ã°ã‚Œã‚‹æƒ³å®š)
// ï¼ˆBã‹ã‚‰ä¸€æ—¦ã‚³ãƒ¡ãƒ³ãƒˆåŒ–ã®ã¿ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼‰
// Route::prefix('shipments')
//     ->middleware(['auth.jwt']) // shop ã‚¹ã‚³ãƒ¼ãƒ—å‰æ
//     ->group(function () {
//         // Route::post('/', [ShipmentController::class, 'store']);
//         Route::post('{id}/pack', [ShipmentController::class, 'pack']);
//         Route::post('{id}/ship', [ShipmentController::class, 'ship']);
//         Route::post('{id}/in-transit', [ShipmentController::class, 'markInTransit']);
//         Route::post('{id}/deliver', [ShipmentController::class, 'deliver']);
//     });


Route::get('/admin/shipments/kpi', AdminShipmentKpiController::class)
    ->middleware(['auth.jwt', 'role:admin']);


Route::get('/me/shipments/{id}', [CustomerShipmentController::class, 'show'])
    ->middleware(['auth.jwt']);









use App\Modules\Order\Presentation\Http\Controllers\GetMyOrderShipmentController;

Route::middleware(['auth.jwt'])->group(function () {
    Route::get(
        '/me/orders/{orderId}/shipment',
        GetMyOrderShipmentController::class
    );
});



use App\Modules\Order\Presentation\Http\Controllers\MeOrderController;
use App\Modules\Order\Presentation\Http\Controllers\OrderReadController;

Route::middleware(['auth.jwt'])->group(function () {
    Route::get('/me/orders', [MeOrderController::class, 'index']);
    Route::get('/me/orders/{orderId}', [OrderReadController::class, 'show']);
});


use App\Modules\User\Presentation\Http\Controllers\UserAddressController;

Route::middleware('auth.jwt')->group(function () {
    Route::get('/me/addresses/primary', [UserAddressController::class, 'primary']);
});










/*
|--------------------------------------------------------------------------
| â‘  Health / Debug
|--------------------------------------------------------------------------
*/
Route::get('/health', fn () => ['status' => 'ok']);

use App\Modules\Item\Infrastructure\Persistence\Query\ItemReadRepository;
use App\Modules\Item\Presentation\Http\Resources\ItemReadResource;

Route::get('/__debug/item/{id}', function ($id) {
    $item = app(ItemReadRepository::class)
        ->findWithDisplayEntities((int)$id);

    if (!$item) {
        return response()->json(['error' => 'not found'], 404);
    }

    return response()->json(
        ItemReadResource::fromRow($item)
    );
});

/*
|--------------------------------------------------------------------------
| â‘¡ Auth / Identityï¼ˆFirebase â†’ JWTï¼‰
|--------------------------------------------------------------------------
*/
use App\Modules\Auth\Presentation\Http\Controllers\{
    FirebaseAuthController,
    TokenController,
    MeController,
    DeviceSessionsController,
    ResendEmailVerificationController
};

// Login / Register
Route::post('/login_or_register', [FirebaseAuthController::class, 'loginOrRegister']);

// Refresh Token
Route::post('/auth/refresh', [TokenController::class, 'refresh']);

// Email Verification Resend
Route::middleware('auth.jwt.optional')
    ->post('/email/verification-notification', ResendEmailVerificationController::class);

// Authenticated
Route::middleware('auth.jwt')->group(function () {
    Route::get('/me', MeController::class);
    Route::post('/logout', [FirebaseAuthController::class, 'logout']);
    Route::get('/auth/sessions', [DeviceSessionsController::class, 'list']);
});

/*
|--------------------------------------------------------------------------
| â‘¢ User / MyPage
|--------------------------------------------------------------------------
*/
use App\Modules\User\Presentation\Http\Controllers\MypageController;
use App\Modules\Order\Presentation\Http\Controllers\MyPageBoughtController;

Route::middleware('auth.jwt')
    ->prefix('mypage')
    ->group(function () {

        // Profile
        Route::get('/profile', [MypageController::class, 'profile']);
        Route::post('/profile', [MypageController::class, 'createProfile']);
        Route::patch('/profile', [MypageController::class, 'updateProfile']);
        Route::post('/profile/image', [MypageController::class, 'updateProfileImage']);

        // MyPage
        Route::get('/sell', [MypageController::class, 'sellItems']);
        Route::get('/bought', MyPageBoughtController::class);
    });

/*
|--------------------------------------------------------------------------
| â‘£ Shop / Tenant
|--------------------------------------------------------------------------
*/
use App\Modules\Shop\Presentation\Http\Controllers\ShopController;

Route::middleware('auth.jwt')->group(function () {
    Route::post('/shops', [ShopController::class, 'create']);
    Route::get('/shops/me', [ShopController::class, 'me']);
});

// Public Shop
use App\Modules\Item\Presentation\Http\Controllers\{
    ShopShowController,
    ShopItemListController
};

Route::prefix('shops/{shop_code}')
    ->middleware('shop.context')
    ->group(function () {
        Route::get('/', ShopShowController::class);
        Route::get('/items', ShopItemListController::class);
    });

/*
|--------------------------------------------------------------------------
| â‘¤ Shop Dashboard / Management
|--------------------------------------------------------------------------
*/
use App\Modules\Order\Presentation\Http\Controllers\ShopOrderListController;
use App\Modules\Order\Presentation\Http\Controllers\ShopOrderShipmentController;
use App\Modules\Shipment\Presentation\Http\Controllers\{
    ShopShipmentListController,
    ShipmentController
};

Route::prefix('shops/{shop_code}')
    ->middleware(['auth.jwt', 'shop.context'])
    ->group(function () {

        Route::get('/dashboard/orders', ShopOrderListController::class);

        Route::get(
            '/dashboard/orders/{orderId}/shipment',
            ShopOrderShipmentController::class
        );

        Route::post(
            '/dashboard/orders/{orderId}/shipment',
            [ShipmentController::class, 'store']
        );

        Route::get('/shipments', ShopShipmentListController::class);
    });

/*
|--------------------------------------------------------------------------
| â‘¥ Item / Public Catalog & Search
|--------------------------------------------------------------------------
*/
use App\Modules\Item\Presentation\Http\Controllers\{
    ItemDetailController,
    PublicCatalogController
};
use App\Modules\Search\Presentation\Http\Controllers\{
    PublicItemSearchController,
    ShopItemSearchController
};

Route::middleware('auth.jwt.optional')->group(function () {
    Route::get('/items/public', PublicCatalogController::class);
    Route::get('/search/items', PublicItemSearchController::class);
    Route::get('/search/shop-items', ShopItemSearchController::class);
    Route::get('/item/{id}', ItemDetailController::class);
});

Route::get('/items/{itemId}', ItemDetailController::class)
    ->whereNumber('itemId')
    ->middleware('auth.jwt.optional');

/*
|--------------------------------------------------------------------------
| â‘¦ Item Draft / Publish
|--------------------------------------------------------------------------
*/
use App\Modules\Item\Presentation\Http\Controllers\{
    CreateItemDraftController,
    UploadItemDraftImageController,
    PublishItemController,
    DeleteItemDraftController
};

Route::middleware('auth.jwt')->group(function () {
    Route::post('/items/drafts', CreateItemDraftController::class);
    Route::post('/items/drafts/{draftId}/image', UploadItemDraftImageController::class);
    Route::post('/items/drafts/{draftId}/publish', PublishItemController::class);
    Route::delete('/items/drafts/{draftId}', DeleteItemDraftController::class);
});

/*
|--------------------------------------------------------------------------
| â‘§ Reaction / Comment
|--------------------------------------------------------------------------
*/
use App\Modules\Reaction\Presentation\Http\Controllers\FavoriteController;
use App\Modules\Comment\Presentation\Http\Controllers\PostCommentController;

Route::middleware('auth.jwt')->group(function () {
    Route::get('/items/favorite', [FavoriteController::class, 'index']);
    Route::post('/reactions/items/{itemId}/favorite', [FavoriteController::class, 'add']);
    Route::delete('/reactions/items/{itemId}/favorite', [FavoriteController::class, 'remove']);
    Route::post('/comment', PostCommentController::class);
});

/*
|--------------------------------------------------------------------------
| â‘¨ Order
|--------------------------------------------------------------------------
*/
use App\Modules\Order\Presentation\Http\Controllers\{
    OrderController,
    ConfirmOrderController,
    MeOrderController,
    OrderReadController,
    GetMyOrderShipmentController
};

Route::middleware('auth.jwt')->group(function () {
    Route::post('/orders', [OrderController::class, 'create']);
    Route::post('/orders/{orderId}/address', [OrderController::class, 'confirmAddress']);
    Route::get('/orders/{orderId}', [OrderController::class, 'detail']);
    Route::post('/orders/{orderId}/confirm', ConfirmOrderController::class);

    Route::get('/me/orders', [MeOrderController::class, 'index']);
    Route::get('/me/orders/{orderId}', [OrderReadController::class, 'show']);
    Route::get('/me/orders/{orderId}/shipment', GetMyOrderShipmentController::class);
});

/*
|--------------------------------------------------------------------------
| â‘© Payment
|--------------------------------------------------------------------------
*/
use App\Modules\Payment\Presentation\Http\Controllers\{
    PaymentController,
    StripeWebhookController,
    PaymentReadController
};

Route::middleware('auth.jwt')->post('/payments/start', [PaymentController::class, 'start']);
Route::post('/webhooks/stripe', StripeWebhookController::class);
Route::middleware('auth.jwt.optional')
    ->get('/payments/latest-by-order', [PaymentReadController::class, 'latestByOrder']);

/*
|--------------------------------------------------------------------------
| â‘ª Shipment
|--------------------------------------------------------------------------
*/
use App\Modules\Shipment\Presentation\Http\Controllers\{
    PackShipmentController,
    ShipShipmentController,
    InTransitShipmentController,
    DeliverShipmentController,
    AdminShipmentKpiController,
    CustomerShipmentController
};

Route::middleware('auth.jwt')->prefix('shipments/{shipmentId}')->group(function () {
    Route::post('pack', PackShipmentController::class);
    Route::post('ship', ShipShipmentController::class);
    Route::post('in-transit', InTransitShipmentController::class);
    Route::post('deliver', DeliverShipmentController::class);
});

Route::get('/admin/shipments/kpi', AdminShipmentKpiController::class)
    ->middleware(['auth.jwt', 'role:admin']);

Route::get('/me/shipments/{id}', [CustomerShipmentController::class, 'show'])
    ->middleware('auth.jwt');

/*
|--------------------------------------------------------------------------
| â‘« Analytics / Entity Processing
|--------------------------------------------------------------------------
*/
use App\Http\Controllers\{
    ItemEntityReviewController,
    ItemEntityAuditController,
    EntityKpiController
};

Route::get('/entity-reviews', [ItemEntityReviewController::class, 'index']);
Route::post('/entity-reviews/{id}/approve', [ItemEntityReviewController::class, 'approve']);
Route::post('/entity-reviews/{id}/reject', [ItemEntityReviewController::class, 'reject']);
Route::get('/item-entities/{id}/audits', [ItemEntityAuditController::class, 'index']);
Route::get('/entity-kpis', EntityKpiController::class);

/*
|--------------------------------------------------------------------------
| â‘¬ User Address
|--------------------------------------------------------------------------
*/
use App\Modules\User\Presentation\Http\Controllers\UserAddressController;

Route::middleware('auth.jwt')
    ->get('/me/addresses/primary', [UserAddressController::class, 'primary']);